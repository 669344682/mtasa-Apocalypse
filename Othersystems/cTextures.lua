--((Project: LakeZ - Zombie Apocalypse))
--((Developers: DorteY))
--((File: Othersystems/cTextures.lua))

local modsTableFile={
	{txdpfad="Files/Models/fire.txd",dffpfad="Files/Models/fire.dff",colpfad="Files/Models/fire.col",modelid=3900},
	{txdpfad="Files/Models/hangar.txd",dffpfad="Files/Models/hangar.dff",colpfad="Files/Models/hangar.col",modelid=3899},
	{txdpfad="Files/Models/baracke.txd",dffpfad="Files/Models/baracke.dff",colpfad="Files/Models/baracke.col",modelid=3951},
	{txdpfad="Files/Models/fence.txd",dffpfad="Files/Models/fence.dff",colpfad="Files/Models/fence.col",modelid=14566},
	{txdpfad="Files/Models/firetruck.txd",dffpfad="Files/Models/firetruck.dff",colpfad="Files/Models/firetruck.col",modelid=2401},
	{txdpfad="Files/Models/hospital.txd",dffpfad="Files/Models/hospital.dff",colpfad="Files/Models/hospital.col",modelid=2324},
	{txdpfad="Files/Models/policecar.txd",dffpfad="Files/Models/policecar.dff",colpfad="Files/Models/policecar.col",modelid=3947},
	{txdpfad="Files/Models/schoolbus.txd",dffpfad="Files/Models/schoolbus.dff",colpfad="Files/Models/schoolbus.col",modelid=2979},
	{txdpfad="Files/Models/civicar.txd",dffpfad="Files/Models/civicar.dff",colpfad="Files/Models/civicar.col",modelid=3949},
	{txdpfad="Files/Models/busstop.txd",dffpfad="Files/Models/busstop.dff",colpfad="Files/Models/busstop.col",modelid=14622},
	{txdpfad="Files/Models/pinwheel.txd",dffpfad="Files/Models/pinwheel.dff",colpfad="Files/Models/pinwheel.col",modelid=2992},
	{txdpfad="Files/Models/transporter.txd",dffpfad="Files/Models/transporter.dff",colpfad="Files/Models/transporter.col",modelid=2689},
	{txdpfad="Files/Models/tower.txd",dffpfad="Files/Models/tower.dff",colpfad="Files/Models/tower.col",modelid=2754},
	{txdpfad="Files/Models/taxicar.txd",dffpfad="Files/Models/taxicar.dff",colpfad="Files/Models/taxicar.col",modelid=3938},
	{txdpfad="Files/Models/police.txd",dffpfad="Files/Models/police.dff",colpfad="Files/Models/police.col",modelid=2779},
	
	{txdpfad="Files/Models/Skins/1.txd",dffpfad="Files/Models/Skins/1.dff",colpfad=nil,modelid=1},
	{txdpfad="Files/Models/Skins/2.txd",dffpfad="Files/Models/Skins/2.dff",colpfad=nil,modelid=2},
	{txdpfad="Files/Models/Skins/7.txd",dffpfad="Files/Models/Skins/7.dff",colpfad=nil,modelid=7},
	{txdpfad="Files/Models/Skins/11.txd",dffpfad="Files/Models/Skins/11.dff",colpfad=nil,modelid=11},
	{txdpfad="Files/Models/Skins/12.txd",dffpfad="Files/Models/Skins/12.dff",colpfad=nil,modelid=12},
	{txdpfad="Files/Models/Skins/40.txd",dffpfad="Files/Models/Skins/40.dff",colpfad=nil,modelid=40},
	{txdpfad="Files/Models/Skins/55.txd",dffpfad="Files/Models/Skins/55.dff",colpfad=nil,modelid=55},
	{txdpfad="Files/Models/Skins/63.txd",dffpfad="Files/Models/Skins/63.dff",colpfad=nil,modelid=63},
	{txdpfad="Files/Models/Skins/76.txd",dffpfad="Files/Models/Skins/76.dff",colpfad=nil,modelid=76},
	{txdpfad="Files/Models/Skins/83.txd",dffpfad="Files/Models/Skins/83.dff",colpfad=nil,modelid=83},
	{txdpfad="Files/Models/Skins/93.txd",dffpfad="Files/Models/Skins/93.dff",colpfad=nil,modelid=93},
	{txdpfad="Files/Models/Skins/297.txd",dffpfad="Files/Models/Skins/297.dff",colpfad=nil,modelid=297},
	{txdpfad="Files/Models/Skins/298.txd",dffpfad="Files/Models/Skins/298.dff",colpfad=nil,modelid=298},
	{txdpfad="Files/Models/Skins/305.txd",dffpfad="Files/Models/Skins/305.dff",colpfad=nil,modelid=305},
	{txdpfad="Files/Models/Skins/312.txd",dffpfad="Files/Models/Skins/312.dff",colpfad=nil,modelid=312},
	
	{txdpfad="Files/Models/Vehicles/405.txd",dffpfad="Files/Models/Vehicles/405.dff",colpfad=nil,modelid=405},
	{txdpfad="Files/Models/Vehicles/422.txd",dffpfad="Files/Models/Vehicles/422.dff",colpfad=nil,modelid=422},
	{txdpfad="Files/Models/Vehicles/429.txd",dffpfad="Files/Models/Vehicles/429.dff",colpfad=nil,modelid=429},
	{txdpfad="Files/Models/Vehicles/433.txd",dffpfad="Files/Models/Vehicles/433.dff",colpfad=nil,modelid=433},
	{txdpfad="Files/Models/Vehicles/434.txd",dffpfad="Files/Models/Vehicles/434.dff",colpfad=nil,modelid=434},
	{txdpfad="Files/Models/Vehicles/466.txd",dffpfad="Files/Models/Vehicles/466.dff",colpfad=nil,modelid=466},
	{txdpfad="Files/Models/Vehicles/478.txd",dffpfad="Files/Models/Vehicles/478.dff",colpfad=nil,modelid=478},
	{txdpfad="Files/Models/Vehicles/487.txd",dffpfad="Files/Models/Vehicles/487.dff",colpfad=nil,modelid=487},
	{txdpfad="Files/Models/Vehicles/489.txd",dffpfad="Files/Models/Vehicles/489.dff",colpfad=nil,modelid=489},
	{txdpfad="Files/Models/Vehicles/542.txd",dffpfad="Files/Models/Vehicles/542.dff",colpfad=nil,modelid=542},
	{txdpfad="Files/Models/Vehicles/562.txd",dffpfad="Files/Models/Vehicles/562.dff",colpfad=nil,modelid=562},
	
	{txdpfad="Files/Models/Weapons/AK74.txd",dffpfad="Files/Models/Weapons/AK74.dff",colpfad=nil,modelid=355},
	{txdpfad="Files/Models/Weapons/M4.txd",dffpfad="Files/Models/Weapons/M4.dff",colpfad=nil,modelid=356},
	{txdpfad="Files/Models/Weapons/Colt45.txd",dffpfad="Files/Models/Weapons/Colt45.dff",colpfad=nil,modelid=346},
	{txdpfad="Files/Models/Weapons/Deagle.txd",dffpfad="Files/Models/Weapons/Deagle.dff",colpfad=nil,modelid=348},
	{txdpfad="Files/Models/Weapons/MP5.txd",dffpfad="Files/Models/Weapons/MP5.dff",colpfad=nil,modelid=353},
	{txdpfad="Files/Models/Weapons/Sniper.txd",dffpfad="Files/Models/Weapons/Sniper.dff",colpfad=nil,modelid=358},
	{txdpfad="Files/Models/Weapons/Shotgun.txd",dffpfad="Files/Models/Weapons/Shotgun.dff",colpfad=nil,modelid=349},
	{txdpfad="Files/Models/Weapons/Rifle.txd",dffpfad="Files/Models/Weapons/Rifle.dff",colpfad=nil,modelid=357},
	{txdpfad="Files/Models/Weapons/Satchel.txd",dffpfad="Files/Models/Weapons/Satchel.dff",colpfad=nil,modelid=363},
	{txdpfad="Files/Models/Weapons/Bomb.txd",dffpfad="Files/Models/Weapons/Bomb.dff",colpfad=nil,modelid=364},
	{txdpfad="Files/Models/Weapons/RocketLauncher.txd",dffpfad="Files/Models/Weapons/RocketLauncher.dff",colpfad=nil,modelid=359},
	{txdpfad="Files/Models/Weapons/RocketLauncherHS.txd",dffpfad="Files/Models/Weapons/RocketLauncherHS.dff",colpfad=nil,modelid=360},
	{txdpfad="Files/Models/Weapons/Molotov.txd",dffpfad="Files/Models/Weapons/Molotov.dff",colpfad=nil,modelid=344},
	{txdpfad="Files/Models/Weapons/Grenade.txd",dffpfad="Files/Models/Weapons/Grenade.dff",colpfad=nil,modelid=342},
	{txdpfad="Files/Models/Weapons/Flamethrower.txd",dffpfad="Files/Models/Weapons/Flamethrower.dff",colpfad=nil,modelid=361},
	{txdpfad="Files/Models/Weapons/CombatShotgun.txd",dffpfad="Files/Models/Weapons/CombatShotgun.dff",colpfad=nil,modelid=351},
}

addEventHandler("onClientResourceStart",resourceRoot,function()
	for i=1,#modsTableFile do
		modelid=modsTableFile[i].modelid
		if(modsTableFile[i].txdpfad~=nil)then
			txd=engineLoadTXD(modsTableFile[i].txdpfad)
			engineImportTXD(txd,modelid)
		end
		if(modsTableFile[i].dffpfad~=nil)then
			dff=engineLoadDFF(modsTableFile[i].dffpfad,modelid)
			engineReplaceModel(dff,modelid)
		end
		if(modsTableFile[i].colpfad~=nil)then
			col=engineLoadCOL(modsTableFile[i].colpfad,modelid)
			engineReplaceCOL(col,modelid)
		end
	end
end)




addEvent("draw:loadDistance",true)
addEventHandler("draw:loadDistance",root,function(amount)
	for _,v in pairs(loadDistanceTable)do
		engineSetModelLODDistance(v[1],getClientData("loadDistance"))
	end
end)


function enableDetails()
	enableDetail()
end
addEvent("draw:details",true)
addEventHandler("draw:details",lp,enableDetails)

function disableDetails()
	disableDetail()
end
addEvent("undraw:details",true)
addEventHandler("undraw:details",lp,disableDetails)

function enableDetail()
	if bEffectEnabledDetail then return end

	-- Load textures
	detail22Texture = dxCreateTexture(":"..settings.generel.scriptname.."/Files/Shaders/Detail/detail22.png", "dxt3")
	detail58Texture = dxCreateTexture(":"..settings.generel.scriptname.."/Files/Shaders/Detail/detail58.png", "dxt3")
	detail68Texture = dxCreateTexture(":"..settings.generel.scriptname.."/Files/Shaders/Detail/detail68.png", "dxt1")
	detail63Texture = dxCreateTexture(":"..settings.generel.scriptname.."/Files/Shaders/Detail/detail63.png", "dxt3")
	dirtyTexture = dxCreateTexture(":"..settings.generel.scriptname.."/Files/Shaders/Detail/dirty.png", "dxt3")
	detail04Texture = dxCreateTexture(":"..settings.generel.scriptname.."/Files/Shaders/Detail/detail04.png", "dxt3")
	detail29Texture = dxCreateTexture(":"..settings.generel.scriptname.."/Files/Shaders/Detail/detail29.png", "dxt3")
	detail55Texture = dxCreateTexture(":"..settings.generel.scriptname.."/Files/Shaders/Detail/detail55.png", "dxt3")
	detail35TTexture = dxCreateTexture(":"..settings.generel.scriptname.."/Files/Shaders/Detail/detail35T.png", "dxt3")

	brickWallShader, tec = getBrickWallShader()
	if brickWallShader then
		grassShader = getGrassShader()
		roadShader = getRoadShader()
		road2Shader = getRoad2Shader()
		paveDirtyShader = getPaveDirtyShader()
		paveStretchShader = getPaveStretchShader()
		barkShader = getBarkShader()
		rockShader = getRockShader()
		mudShader = getMudShader()
		concreteShader = getBrickWallShader()
		sandShader = getMudShader()
	end

	-- Get list of all elements used
	effectPartsDetail = {
						detail22Texture, detail58Texture, detail68Texture, detail63Texture, dirtyTexture,
						detail04Texture, detail29Texture, detail55Texture, detail35TTexture,
						brickWallShader, grassShader, roadShader, road2Shader, paveDirtyShader,
						paveStretchShader, barkShader, rockShader, mudShader,
						concreteShader, sandShader
					}

	-- Check list of all elements used
	bAllValidDetail = true
	for _,part in ipairs(effectPartsDetail) do
		bAllValidDetail = part and bAllValidDetail
	end

	bEffectEnabledDetail = true

	if not bAllValidDetail then
		disableDetail()
	else
		engineApplyShaderToWorldTexture ( roadShader, "*road*" )
		engineApplyShaderToWorldTexture ( roadShader, "*tar*" )
		engineApplyShaderToWorldTexture ( roadShader, "*asphalt*" )
		engineApplyShaderToWorldTexture ( roadShader, "*freeway*" )
		engineApplyShaderToWorldTexture ( concreteShader, "*wall*" )
		engineApplyShaderToWorldTexture ( concreteShader, "*floor*" )
		engineApplyShaderToWorldTexture ( concreteShader, "*bridge*" )
		engineApplyShaderToWorldTexture ( concreteShader, "*conc*" )
		engineApplyShaderToWorldTexture ( concreteShader, "*drain*" )
		engineApplyShaderToWorldTexture ( paveDirtyShader, "*walk*" )
		engineApplyShaderToWorldTexture ( paveDirtyShader, "*pave*" )
		engineApplyShaderToWorldTexture ( paveDirtyShader, "*cross*" )

		engineApplyShaderToWorldTexture ( mudShader, "*mud*" )
		engineApplyShaderToWorldTexture ( mudShader, "*dirt*" )
		engineApplyShaderToWorldTexture ( rockShader, "*rock*" )
		engineApplyShaderToWorldTexture ( rockShader, "*stone*" )
		engineApplyShaderToWorldTexture ( grassShader, "*grass*" )
		engineApplyShaderToWorldTexture ( grassShader, "desertgryard256" )	-- grass

		engineApplyShaderToWorldTexture ( sandShader, "*sand*" )
		engineApplyShaderToWorldTexture ( barkShader, "*leave*" )
		engineApplyShaderToWorldTexture ( barkShader, "*log*" )
		engineApplyShaderToWorldTexture ( barkShader, "*bark*" )

		-- Roads
		engineApplyShaderToWorldTexture ( roadShader, "*carpark*" )
		engineApplyShaderToWorldTexture ( road2Shader, "*hiway*" )
		engineApplyShaderToWorldTexture ( roadShader, "*junction*" )
		engineApplyShaderToWorldTexture ( paveStretchShader, "snpedtest*" )

		-- Pavement
		engineApplyShaderToWorldTexture ( paveStretchShader, "sidelatino*" )
		engineApplyShaderToWorldTexture ( paveStretchShader, "sjmhoodlawn41" )

		-- Remove detail from LOD models etc.
		for i,part in ipairs(effectPartsDetail) do
			if getElementType(part) == "shader" then
				engineRemoveShaderFromWorldTexture ( part, "tx*" )
				engineRemoveShaderFromWorldTexture ( part, "lod*" )
			end
		end
	end

end

function disableDetail()
	if not bEffectEnabledDetail then return end

	-- Destroy all parts
	for _,part in ipairs(effectPartsDetail) do
		if part then
			destroyElement( part )
		end
	end
	effectPartsDetail = {}
	bAllValidDetail = false

	-- Flag effect as stopped
	bEffectEnabledDetail = false
end

function getBrickWallShader()
	return getMakeShader( getBrickWallSettings () )
end

function getGrassShader()
	return getMakeShader( getGrassSettings () )
end

function getRoadShader()
	return getMakeShader( getRoadSettings () )
end

function getRoad2Shader()
	return getMakeShader( getRoad2Settings () )
end

function getPaveDirtyShader()
	return getMakeShader( getPaveDirtySettings () )
end

function getPaveStretchShader()
	return getMakeShader( getPaveStretchSettings () )
end

function getBarkShader()
	return getMakeShader( getBarkSettings () )
end

function getRockShader()
	return getMakeShader( getRockSettings () )
end

function getMudShader()
	return getMakeShader( getMudSettings () )
end

function getMakeShader(vDetail)
	--  Create shader with a draw range of 100 units
	local shader,tec = dxCreateShader ( ":"..settings.generel.scriptname.."/Files/Shaders/Detail/detail.fx", 1, 100 )
	if shader then
		dxSetShaderValue( shader, "sDetailTexture", vDetail.texture )
		dxSetShaderValue( shader, "sDetailScale", vDetail.detailScale )
		dxSetShaderValue( shader, "sFadeStart", vDetail.sFadeStart )
		dxSetShaderValue( shader, "sFadeEnd", vDetail.sFadeEnd )
		dxSetShaderValue( shader, "sStrength", vDetail.sStrength )
		dxSetShaderValue( shader, "sAnisotropy", vDetail.sAnisotropy )
	end
	return shader,tec
end

function getBrickWallSettings ()
	local vDetail = {}
	vDetail.texture=detail22Texture
	vDetail.detailScale=3
	vDetail.sFadeStart=60
	vDetail.sFadeEnd=100
	vDetail.sStrength=0.6
	vDetail.sAnisotropy=1
	return vDetail
end
---------------------------------

-- grass
---------------------------------
function getGrassSettings ()
	local vDetail = {}
	vDetail.texture=detail58Texture
	vDetail.detailScale=2
	vDetail.sFadeStart=60
	vDetail.sFadeEnd=100
	vDetail.sStrength=0.6
	vDetail.sAnisotropy=1
	return vDetail
end
---------------------------------

-- road
---------------------------------
function getRoadSettings ()
	local vDetail = {}
	vDetail.texture=detail68Texture
	vDetail.detailScale=1
	vDetail.sFadeStart=60
	vDetail.sFadeEnd=100
	vDetail.sStrength=0.6
	vDetail.sAnisotropy=1
	return vDetail
end
---------------------------------

-- road2
---------------------------------
function getRoad2Settings ()
	local vDetail = {}
	vDetail.texture=detail63Texture
	vDetail.detailScale=1
	vDetail.sFadeStart=90
	vDetail.sFadeEnd=100
	vDetail.sStrength=0.7
	vDetail.sAnisotropy=0.9
	return vDetail
end
---------------------------------

-- dirty pave
---------------------------------
function getPaveDirtySettings ()
	local vDetail = {}
	vDetail.texture=dirtyTexture
	vDetail.detailScale=1
	vDetail.sFadeStart=60
	vDetail.sFadeEnd=100
	vDetail.sStrength=0.4
	vDetail.sAnisotropy=1
	return vDetail
end
---------------------------------

-- stretch pave 
---------------------------------
function getPaveStretchSettings ()
	local vDetail = {}
	vDetail.texture=detail04Texture
	vDetail.detailScale=1
	vDetail.sFadeStart=80
	vDetail.sFadeEnd=100
	vDetail.sStrength=0.3
	vDetail.sAnisotropy=1
	return vDetail
end
---------------------------------

-- tree bark
---------------------------------
function getBarkSettings ()
	local vDetail = {}
	vDetail.texture=detail29Texture
	vDetail.detailScale=1
	vDetail.sFadeStart=80
	vDetail.sFadeEnd=100
	vDetail.sStrength=0.6
	vDetail.sAnisotropy=1
	return vDetail
end
---------------------------------

-- rock
---------------------------------
function getRockSettings ()
	local vDetail = {}
	vDetail.texture=detail55Texture
	vDetail.detailScale=1
	vDetail.sFadeStart=80
	vDetail.sFadeEnd=100
	vDetail.sStrength=0.5
	vDetail.sAnisotropy=1
	return vDetail
end
---------------------------------

-- mud
---------------------------------
function getMudSettings ()
	local vDetail = {}
	vDetail.texture=detail35TTexture
	vDetail.detailScale=2
	vDetail.sFadeStart=80
	vDetail.sFadeEnd=100
	vDetail.sStrength=0.6
	vDetail.sAnisotropy=1
	return vDetail
end








--((Snow))
local maxEffectDistance=250
local snowApplyList={
	"*"
}
local snowRemoveList={
	"",
	"vehicle*","?emap*","?hite*",
	"*92*","*wheel*","*interior*",
	"*handle*","*body*","*decal*",
	"*8bit*","*logos*","*badge*",
	"*plate*","*sign*",
	"headlight","headlight1",
	"shad*",
	"coronastar",
	"tx*",
	"lod*",
	"cj_w_grad",
	"*cloud*",
	"*smoke*",
	"sphere_cj",
	"particle*",
	"*water*","sw_sand","coral",
}
local treeApplyList={
	"sm_des_bush*","*tree*","*ivy*","*pine*",
	"veg_*","*largefur*","hazelbr*","weeelm",
	"*branch*","cypress*",
	"*bark*","gen_log","trunk5",
	"bchamae","vegaspalm01_128",
}

local naughtyTreeApplyList={
	"planta256","sm_josh_leaf","kbtree4_test","trunk3",
	"newtreeleaves128","ashbrnch","pinelo128","tree19mi",
	"lod_largefurs07","veg_largefurs05","veg_largefurs06",
	"fuzzyplant256","foliage256","cypress1","cypress2",
}



function toggleGoundSnow()
	triggerEvent("switchGoundSnow",resourceRoot,not bEffectEnabled)
end

function switchGoundSnow(typ)
	if(typ)then
		enableGoundSnow()
	else
		disableGoundSnow()
	end
end
addEvent("switchGoundSnow",true)
addEventHandler("switchGoundSnow",lp,switchGoundSnow)



function enableGoundSnow()
	if(bEffectEnabled)then
		return
	end
	snowShader=dxCreateShader(":"..settings.generel.scriptname.."/Files/Shaders/Snow/Ground.fx",0,maxEffectDistance)
	treeShader=dxCreateShader(":"..settings.generel.scriptname.."/Files/Shaders/Snow/Trees.fx")
	naughtyTreeShader=dxCreateShader(":"..settings.generel.scriptname.."/Files/Shaders/Snow/NaughtyTrees.fx")
	sNoiseTexture=dxCreateTexture(":"..settings.generel.scriptname.."/Files/Shaders/Snow/Snow.dds")
	
	if(not snowShader or not treeShader or not naughtyTreeShader or not sNoiseTexture)then
		return nil
	end
	
	dxSetShaderValue(treeShader,"sNoiseTexture",sNoiseTexture)
	dxSetShaderValue(naughtyTreeShader,"sNoiseTexture",sNoiseTexture)
	dxSetShaderValue(snowShader,"sNoiseTexture",sNoiseTexture)
	dxSetShaderValue(snowShader,"sFadeEnd",maxEffectDistance)
	dxSetShaderValue(snowShader,"sFadeStart",maxEffectDistance/2)
	
	for _,v in ipairs(snowApplyList) do
		engineApplyShaderToWorldTexture(snowShader,v)
	end

	for _,v in ipairs(snowRemoveList) do
		engineRemoveShaderFromWorldTexture(snowShader,v)
	end

	for _,v in ipairs(treeApplyList) do
		engineApplyShaderToWorldTexture(treeShader,v)
	end

	for _,v in ipairs(naughtyTreeApplyList) do
		engineApplyShaderToWorldTexture(naughtyTreeShader,v)
	end
	
	
	doneVehTexRemove={}
	vehTimer=setTimer(checkCurrentVehicle,100,0)
	removeVehTextures()
	bEffectEnabled=true
end


function disableGoundSnow()
	if(not bEffectEnabled)then
		return
	end
	sNoiseTexture:destroy()
	treeShader:destroy()
	naughtyTreeShader:destroy()
	snowShader:destroy()
	vehTimer:destroy()
	bEffectEnabled=false
end




function checkCurrentVehicle()
	local veh=getPedOccupiedVehicle(localPlayer)
	local id=veh and getElementModel(veh)
	if(lastveh~=veh or lastid~=id)then
		lastveh=veh
		lastid=id
		removeVehTexturesSoon()
	end
	if(nextCheckTime<getTickCount())then
		nextCheckTime=getTickCount()+5000
		removeVehTextures()
	end
end

function removeVehTexturesSoon()
    nextCheckTime=getTickCount()+200
end

function removeVehTextures ()
	if(not bHasFastRemove)then
		return
	end

	local veh=getPedOccupiedVehicle(localPlayer)
	if(veh)then
		local id=getElementModel(veh)
		local vis=engineGetVisibleTextureNames("*",id)
		if(vis)then	
			for _,removeMatch in pairs(vis)do
				if(not doneVehTexRemove[removeMatch])then
					doneVehTexRemove[removeMatch]=true
					engineRemoveShaderFromWorldTexture(snowShader,removeMatch)
				end
			end
		end
	end
end



_dxCreateShader=dxCreateShader
function dxCreateShader(filepath,priority,maxDistance,bDebug)
	priority=priority or 0
	maxDistance=maxDistance or 0
	bDebug=bDebug or false
	local build=getVersion().sortable:sub(9)
	local fullscreen=not dxGetStatus().SettingWindowed
	if(build<"03236" and fullscreen)then
		maxDistance=0
	end
	return _dxCreateShader(filepath,priority,maxDistance,bDebug)
end